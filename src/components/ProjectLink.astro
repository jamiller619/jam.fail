---
const { title, image, link, description } = Astro.props
---
<script>
  import Splitting from 'splitting'
  import 'splitting/dist/splitting.css'
  import 'splitting/dist/splitting-cells.css'
  import { animate } from 'animejs'

  class ProjectLink extends HTMLAnchorElement {
    connectedCallback() {
      Splitting({
        target: this.querySelector('h2')!,
      })

      const targets = this.querySelectorAll('.char')
      const enter = animate(targets, {
        translateY: {
          from: -40,
          to: 0,
        },
        opacity: {
          from: 0,
          to: 1,
        },
        easing: 'easeOut',
        duration: 280,
        delay: (_, i) => 30 * i,
        autoplay: false,
      })

      this.addEventListener('pointerenter', () => enter.restart())
      this.addEventListener('pointerleave', () => enter.reverse())
    }
  }

  customElements.define('project-link', ProjectLink, {
    extends: 'a',
  })
</script>

<style>
  a[is="project-link"] {
    aspect-ratio: var(--ratio-landscape);
    background-size: 100%;
    background-size: cover;
    background-position: center;
    display: flex;
    flex-direction: column;
    justify-content: end;
    text-decoration: none;
    box-shadow: var(--shadow-2);
    padding: var(--size-6);
    border-radius: var(--radius-2);
    overflow: hidden;
    cursor: pointer;

    @media (min-width: 1024px) {
      filter: grayscale(1);
      transition: filter 150ms;

      .content {
        display: block;
        opacity: 0;
        transform: translateY(20px);
        transition:
          transform 150ms ease-in-out,
          opacity 150ms ease-out;
      }
    }

    &:hover,
    &:focus {
      filter: grayscale(0);

      .content {
        opacity: 1;
        transform: translateY(0);
      }
    }

    h2 {
      margin: 0;
    }

    .content {
      display: flex;
      flex-direction: column;
    }
  }
</style>

<a is="project-link"
  href={link}
  style={{
    backgroundImage: `url(${image.url.src})`,
  }}>
  <span class="content">
    <h2>{title}</h2>
    <p>{description}</p>
  </span>
</a>
